{% if comments %}
    <h3>Результаты ({{ comments|length }}):</h3>
    <ul id="all-comments">
    {% for c in comments %}
        <li><strong>{{ c.author }}</strong>: {{ c.text }} <em>({{ c.date }})</em></li>
    {% endfor %}
    </ul>

    <button onclick="detectBots()">Detect</button>
    <h3>Подозрительные пользователи:</h3>
    <ul id="bot-comments"></ul>

    <script>
        function detectBots() {
            const all = document.querySelectorAll("#all-comments li");
            const bots = [];

            all.forEach(el => {
                const text = el.textContent.trim();
                const match = text.match(/^@([^\s:]+)/);
                if (match) {
                    const username = match[1];
                    const isBot = username.startsWith("user") || /\d{3,}/.test(username);
                    if (isBot) {
                        bots.push(el.cloneNode(true));
                    }
                }
            });

            const botList = document.getElementById("bot-comments");
            botList.innerHTML = "";
            bots.forEach(b => botList.appendChild(b));
        }
    </script>
{% endif %}
